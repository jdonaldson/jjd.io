<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Justin Donaldson">
<meta name="dcterms.date" content="2025-02-12">
<meta name="description" content="Managing an AI project isn’t like traditional software development—it’s messy, experimental, and requires constant iteration. Data is rarely clean, models need fine-tuning, and deployment is just the beginning. Success comes from setting clear metrics, planning for maintenance, and knowing when ML is the right tool (and when it’s not). Most importantly, strong communication keeps everyone aligned and avoids the dreaded “black box” syndrome.">

<title>10 Things an AI Project Manager Needs To Know – Justin Donaldson, Ph.D.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/nav-logo.jpeg" rel="icon" type="image/jpeg">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-af1a5eef57a0beae2532659473833200.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-J1DD0F3VY9"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-J1DD0F3VY9', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../style.css">
<meta property="og:title" content="10 Things an AI Project Manager Needs To Know – Justin Donaldson, Ph.D.">
<meta property="og:description" content="Managing an AI project isn’t like traditional software development—it’s messy, experimental, and requires constant iteration. Data is rarely clean, models need fine-tuning, and deployment is just the beginning. Success comes from setting clear metrics, planning for maintenance, and knowing when ML is the right tool (and when it’s not). Most importantly, strong communication keeps everyone aligned and avoids the dreaded “black box” syndrome.">
<meta property="og:image" content="http://www.jjd.io/posts/images/omgjjd_norman_rockwell._children_programming_an_AI_af3ffb58-9afe-4038-beed-3babfd6e7005.png">
<meta property="og:site_name" content="Justin Donaldson, Ph.D.">
<meta property="og:image:height" content="1024">
<meta property="og:image:width" content="1024">
<meta name="twitter:title" content="10 Things an AI Project Manager Needs To Know – Justin Donaldson, Ph.D.">
<meta name="twitter:description" content="Managing an AI project isn’t like traditional software development—it’s messy, experimental, and requires constant iteration. Data is rarely clean, models need fine-tuning, and deployment is just the beginning. Success comes from setting clear metrics, planning for maintenance, and knowing when ML is the right tool (and when it’s not). Most importantly, strong communication keeps everyone aligned and avoids the dreaded “black box” syndrome.">
<meta name="twitter:image" content="http://www.jjd.io/posts/images/omgjjd_norman_rockwell._children_programming_an_AI_af3ffb58-9afe-4038-beed-3babfd6e7005.png">
<meta name="twitter:site" content="@omgjjd">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1024">
<meta name="twitter:image-width" content="1024">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/nav-logo.jpeg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Justin Donaldson, Ph.D.</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv.html"> 
<span class="menu-text">cv</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jdonaldson"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/omgjjd"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/jjustindonaldson/"> <i class="bi bi-linkedin" role="img" aria-label="Linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.discogs.com/user/omgjjd"> <i class="bi bi-vinyl-fill" role="img" aria-label="Discogs">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">10 Things an AI Project Manager Needs To Know</h1>
  <div class="quarto-categories">
    <div class="quarto-category">AI</div>
    <div class="quarto-category">Engineering</div>
    <div class="quarto-category">Best Practices</div>
  </div>
  </div>

<div>
  <div class="description">
    Managing an AI project isn’t like traditional software development—it’s messy, experimental, and requires constant iteration. Data is rarely clean, models need fine-tuning, and deployment is just the beginning. Success comes from setting clear metrics, planning for maintenance, and knowing when ML is the right tool (and when it’s not). Most importantly, strong communication keeps everyone aligned and avoids the dreaded “black box” syndrome.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Justin Donaldson </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/omgjjd_norman_rockwell._children_programming_an_AI_af3ffb58-9afe-4038-beed-3babfd6e7005.png" class="preview-image img-fluid figure-img"></p>
<figcaption>Things to Know About AI Management</figcaption>
</figure>
</div>
<p>A successful AI project manager needs to embrace uncertainties, balancing technical feasibility with business goals. It’s not just about building a model—it’s about understanding when machine learning is the right tool, defining success metrics early, and ensuring models remain useful long after deployment.</p>
<p>Perhaps most importantly, AI project managers act as the bridge between data scientists, engineers, and business stakeholders. Without strong communication, projects can devolve into a “black box” where decisions are made without clear explanations. To keep everyone aligned, PMs must translate technical complexities into practical insights, ensuring AI delivers real-world impact.</p>
<p>This guide covers ten crucial things every AI project manager needs to know, from managing messy data to avoiding costly mistakes.</p>
<section id="data-is-everything-and-its-often-messy" class="level2">
<h2 class="anchored" data-anchor-id="data-is-everything-and-its-often-messy">1. Data is Everything (And It’s Often Messy)</h2>
<p><img src="images/omgjjd_norman_rockwell._messy_room_and_not_much_time_to_clean_i_199bfde1-85fc-42bc-a48f-443e05f2ba0c.png" class="img-fluid" alt="Messy Data"> ML models live and die by the quality of data. Unlike traditional software, where development is more deterministic, ML projects require extensive data collection, cleaning, and preprocessing before even getting to model training. PMs should allocate time and resources for proper data preparation rather than assuming clean datasets exist.</p>
</section>
<section id="models-are-not-magic-they-require-experimentation" class="level2">
<h2 class="anchored" data-anchor-id="models-are-not-magic-they-require-experimentation">2. Models Are Not Magic – They Require Experimentation</h2>
<p><img src="images/omgjjd_norman_rockwell._Models_are_not_magic._They_require_expe_8c440650-e881-4580-afcc-e7b0a748722c.png" class="img-fluid" alt="Intelligence Requires Experimentation"> ML isn’t just about feeding data into an algorithm and getting perfect results. It involves iterative experimentation, hyperparameter tuning, and evaluation to find the best-performing model. Rushing the process or setting unrealistic deadlines can lead to poor model performance and technical debt.</p>
</section>
<section id="define-success-metrics-early" class="level2">
<h2 class="anchored" data-anchor-id="define-success-metrics-early">3. Define Success Metrics Early</h2>
<p><img src="images/omgjjd_norman_rockwell._multi-ethnic._define_sucess_metrics_ear_00c79b48-3650-4165-8681-7cb7ee60fd54.png" class="img-fluid" alt="Defining Success"> Project Managers should work with ML teams to define clear, measurable success metrics upfront. Whether it’s accuracy, recall, precision, F1-score, or business KPIs, agreeing on success criteria helps avoid last-minute changes in expectations.</p>
</section>
<section id="ml-models-need-maintenance-and-monitoring" class="level2">
<h2 class="anchored" data-anchor-id="ml-models-need-maintenance-and-monitoring">4. ML Models Need Maintenance and Monitoring</h2>
<p><img src="images/omgjjd_norman_rockwell._multi-ethnic._robots_require_maintenanc_68f61ca3-00c0-4f6d-bd8d-648c9b35fa3b.png" class="img-fluid" alt="Some Maintenance Required"> Unlike traditional software, ML models degrade over time due to data drift and changing user behavior. Deployment is just the beginning—models require ongoing monitoring, retraining, and evaluation. PMs should plan for post-deployment maintenance and allocate resources accordingly.</p>
</section>
<section id="computational-costs-can-be-high" class="level2">
<h2 class="anchored" data-anchor-id="computational-costs-can-be-high">5. Computational Costs Can Be High</h2>
<p><img src="images/omgjjd_norman_rockwell._money_problems._04914a25-c5f1-4c36-b52a-3dfe88f50fe2.png" class="img-fluid" alt="Costs are High"> Training large ML models, especially deep learning models, requires significant computational resources. GPUs, TPUs, and cloud compute can be expensive. PMs should work with engineers to balance cost, performance, and feasibility when designing ML solutions.</p>
</section>
<section id="explainability-matters-but-its-not-always-easy" class="level2">
<h2 class="anchored" data-anchor-id="explainability-matters-but-its-not-always-easy">6. Explainability Matters – But It’s Not Always Easy</h2>
<p><img src="images/omgjjd_norman_rockwell._parents_looking_disappointed_at_kids_th_87f1f2b0-7dc2-4ab6-9f52-fdb26600b226.png" class="img-fluid" alt="Explainability Matters"> Stakeholders often ask, “Why did the model make this decision?” While some models (like decision trees) are interpretable, deep learning models can be black boxes. Expecting full explainability from every ML model is unrealistic, but PMs should work with engineers to determine an appropriate level of transparency.</p>
</section>
<section id="not-every-problem-needs-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="not-every-problem-needs-machine-learning">7. Not Every Problem Needs Machine Learning</h2>
<p><img src="images/omgjjd_norman_rockwell._multi-ethnic._Not_every_problem_needs_m_664350cd-c96b-4175-a167-7bd4796b353c.png" class="img-fluid" alt="AI Not Required"> Just because ML is trendy doesn’t mean it’s always the best solution. Many problems can be solved with simpler heuristics, rule-based systems, or traditional analytics. PMs should work with engineers to evaluate whether ML is the right tool for the job rather than assuming it’s always necessary.</p>
</section>
<section id="data-privacy-and-compliance-are-critical" class="level2">
<h2 class="anchored" data-anchor-id="data-privacy-and-compliance-are-critical">8. Data Privacy and Compliance Are Critical</h2>
<p><img src="images/omgjjd_norman_rockwell._multi-ethnic._children._courtoom_argume_178079bc-979f-4ce9-90f9-f7826db8db42.png" class="img-fluid" alt="Courtroom Drama"> ML engineers need to follow strict data privacy laws like GDPR and CCPA. PMs should be aware of these regulations and plan projects with compliance in mind, ensuring legal and ethical handling of user data.</p>
</section>
<section id="data-scientists-and-ml-engineers-are-not-the-same" class="level2">
<h2 class="anchored" data-anchor-id="data-scientists-and-ml-engineers-are-not-the-same">9. Data Scientists and ML Engineers Are Not the Same</h2>
<p><img src="images/omgjjd_norman_rockwell._data_scientists_and_ML_engineers_are_no_6f4b16c4-d547-47f9-b7a6-3f481e9c79b1.png" class="img-fluid" alt="Different Breed"> While both roles work with data, data scientists focus on analytics, insights, and modeling, while ML engineers focus on productionizing and scaling models. Understanding this distinction helps PMs allocate tasks more effectively and set realistic expectations.</p>
</section>
<section id="communication-is-key-avoid-the-black-box-syndrome" class="level2">
<h2 class="anchored" data-anchor-id="communication-is-key-avoid-the-black-box-syndrome">10. Communication Is Key – Avoid the “Black Box” Syndrome</h2>
<p><img src="images/omgjjd_norman_rockwell._multi-ethnic_workplace._mysterious_blac_32589cdc-96d7-4d32-b1b8-d0ffab14d73c.png" class="img-fluid" alt="Mysterious Black Box"> ML engineers and data scientists sometimes get deep into technical work, making it hard for PMs and stakeholders to follow. At the same time, vague project requirements can lead to misalignment. Regular check-ins, clear documentation, and collaborative discussions ensure everyone stays on the same page.</p>


</section>

<p><i>© Copyright 2024 Justin Donaldson. Except where otherwise noted, all rights reserved. The views and opinions on this website are my own and do not represent my current or former employers.</i></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("http:\/\/www\.jjd\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>